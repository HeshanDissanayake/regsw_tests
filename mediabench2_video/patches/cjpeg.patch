--- /home/heshds/working_dir/regsw_tests/mediabench2_video/cjpeg/jpeg-6b/Makefile	2025-08-23 11:54:04.457156393 +1000
+++ /home/heshds/working_dir/regsw_tests/mediabench2_video/cjpeg/jpeg-6b/Makefile_old	2025-08-21 15:35:27.927093892 +1000
@@ -8,6 +8,19 @@
 # For compiling with source and object files in different directories.
 srcdir = .
 
+ifeq ($(REGSW), true)
+	REGSW_COMPILER=/home/heshds/working_dir/regsw_tests/scripts/regsw_compile_linux.sh
+	regsw_mode = _regsw
+else
+	REGSW_COMPILER=/home/heshds/working_dir/regsw_tests/scripts/normal_compile_linux.sh
+	regsw_mode = 
+endif
+
+# Compiler
+export RISCV_CC = /opt/dev/riscv_linux_rv64g_regsw/bin/riscv64-unknown-linux-gnu-gcc
+# Compiler flags
+export RISCV_CFLAGS = --sysroot=/home/heshds/working_dir/cva6-sdk/buildroot/output/host/riscv64-buildroot-linux-gnu/sysroot
+
 # Where to install the programs and man pages.
 prefix = /usr/local
 exec_prefix = ${prefix}
@@ -20,7 +33,7 @@
 mandir = $(prefix)/man/man$(manext)
 
 # The name of your C compiler:
-CC= gcc
+CC= $(RISCV_CC)
 
 # You may need to adjust these cc options:
 CFLAGS= -O2  -I$(srcdir)
@@ -30,10 +43,10 @@
 ANSI2KNRFLAGS= 
 
 # Link-time cc options:
-LDFLAGS= 
+LDFLAGS= $(RISCV_CFLAGS)
 
 # To link any special libraries, add the necessary -l commands here.
-LDLIBS= 
+LDLIBS= $(RISCV_CFLAGS)
 
 # If using GNU libtool, LIBTOOL references it; if not, LIBTOOL is empty.
 LIBTOOL = 
@@ -174,23 +187,24 @@
 # sample programs:
 
 cjpeg: $(COBJECTS) libjpeg.$(A)
-	$(LN) $(LDFLAGS) -o cjpeg $(COBJECTS) libjpeg.$(A) $(LDLIBS)
+	$(LN) $(LDFLAGS) -o cjpeg$(regsw_mode) $(COBJECTS) libjpeg.$(A) $(LDLIBS)
 
 djpeg: $(DOBJECTS) libjpeg.$(A)
-	$(LN) $(LDFLAGS) -o djpeg $(DOBJECTS) libjpeg.$(A) $(LDLIBS)
+	$(LN) $(LDFLAGS) -o djpeg$(regsw_mode) $(DOBJECTS) libjpeg.$(A) $(LDLIBS)
 
 jpegtran: $(TROBJECTS) libjpeg.$(A)
-	$(LN) $(LDFLAGS) -o jpegtran $(TROBJECTS) libjpeg.$(A) $(LDLIBS)
+	$(LN) $(LDFLAGS) -o jpegtran$(regsw_mode) $(TROBJECTS) libjpeg.$(A) $(LDLIBS)
 
 rdjpgcom: rdjpgcom.$(O)
-	$(LN) $(LDFLAGS) -o rdjpgcom rdjpgcom.$(O) $(LDLIBS)
+	$(LN) $(LDFLAGS) -o rdjpgcom$(regsw_mode) rdjpgcom.$(O) $(LDLIBS)
 
 wrjpgcom: wrjpgcom.$(O)
-	$(LN) $(LDFLAGS) -o wrjpgcom wrjpgcom.$(O) $(LDLIBS)
+	$(LN) $(LDFLAGS) -o wrjpgcom$(regsw_mode) wrjpgcom.$(O) $(LDLIBS)
 
 # Installation rules:
 
 install: cjpeg djpeg jpegtran rdjpgcom wrjpgcom 
+
 	$(INSTALL_PROGRAM) cjpeg $(bindir)/$(binprefix)cjpeg
 	$(INSTALL_PROGRAM) djpeg $(bindir)/$(binprefix)djpeg
 	$(INSTALL_PROGRAM) jpegtran $(bindir)/$(binprefix)jpegtran
@@ -202,6 +216,21 @@
 	$(INSTALL_DATA) $(srcdir)/rdjpgcom.1 $(mandir)/$(manprefix)rdjpgcom.$(manext)
 	$(INSTALL_DATA) $(srcdir)/wrjpgcom.1 $(mandir)/$(manprefix)wrjpgcom.$(manext)
 
+copy-to-build:
+	mkdir -p $(srcdir)/build
+	cp cjpeg$(regsw_mode) build/
+	cp djpeg$(regsw_mode) build/
+	cp jpegtran$(regsw_mode) build/
+	cp rdjpgcom$(regsw_mode) build/
+	cp wrjpgcom$(regsw_mode) build/
+
+# copy the required input files for the testing
+	cp $(srcdir)/testorig.jpg   build/testorig.jpg
+	cp $(srcdir)/testimg.ppm    build/testimg.ppm
+	cp $(srcdir)/testprog.jpg   build/testprog.jpg
+ 
+
+
 install-lib: libjpeg.$(A) install-headers
 	$(INSTALL_LIB) libjpeg.$(A) $(libdir)/$(binprefix)libjpeg.$(A)
 
@@ -213,7 +242,7 @@
 
 clean:
 	$(RM) *.o *.lo libjpeg.a libjpeg.la
-	$(RM) cjpeg djpeg jpegtran rdjpgcom wrjpgcom
+	$(RM) cjpeg$(regsw_mode) djpeg$(regsw_mode) jpegtran$(regsw_mode) rdjpgcom$(regsw_mode) wrjpgcom$(regsw_mode)
 	$(RM) ansi2knr core testout* config.log config.status
 	$(RM) -r knr .libs _libs
 
@@ -237,6 +266,10 @@
 
 check: test
 
+%.o: %.c
+	$(REGSW_COMPILER) $< -o $@
+
+
 # Mistake catcher:
 
 jconfig.h: jconfig.doc
@@ -316,4 +349,4 @@
 rdbmp.$(O): rdbmp.c cdjpeg.h jinclude.h jconfig.h jpeglib.h jmorecfg.h jerror.h cderror.h
 wrbmp.$(O): wrbmp.c cdjpeg.h jinclude.h jconfig.h jpeglib.h jmorecfg.h jerror.h cderror.h
 rdrle.$(O): rdrle.c cdjpeg.h jinclude.h jconfig.h jpeglib.h jmorecfg.h jerror.h cderror.h
-wrrle.$(O): wrrle.c cdjpeg.h jinclude.h jconfig.h jpeglib.h jmorecfg.h jerror.h cderror.h
+wrrle.$(O): wrrle.c cdjpeg.h jinclude.h jconfig.h jpeglib.h jmorecfg.h jerror.h cderror.h
\ No newline at end of file
